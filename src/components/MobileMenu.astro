---
interface Props {
    currentPath: string;
}

const { currentPath } = Astro.props;

const navItems = [
    { href: '/', label: 'Etusivu' },
    { href: '/vartijakoulutus', label: 'Koulutus' },
    { href: '/tyo-ja-palkka', label: 'Työ & Palkka' },
    { href: '/tyopaikat', label: 'Työpaikat' },
    { href: '#', label: 'Blogi' },
];
---

<!-- Mobile Menu Overlay -->
<div class="mobile-menu-overlay" id="mobile-menu-overlay" aria-hidden="true"></div>

<!-- Mobile Menu -->
<nav class="mobile-menu bg-background-light dark:bg-surface-dark" id="mobile-menu" aria-label="Mobiilinavigaatio" aria-hidden="true">
    <div class="flex flex-col h-full">
        <div class="flex items-center justify-between p-4 border-b border-slate-200 dark:border-surface-dark-lighter">
            <span class="font-bold">Valikko</span>
            <button type="button" class="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-surface-dark-lighter transition-colors" aria-label="Sulje valikko" id="mobile-menu-close">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <path d="M18 6 6 18"/>
                    <path d="m6 6 12 12"/>
                </svg>
            </button>
        </div>
        <div class="flex-1 overflow-y-auto p-4">
            <ul class="space-y-2">
                {navItems.map(item => (
                    <li>
                        <a
                            href={item.href}
                            class:list={[
                                "block py-3 px-4 rounded-lg transition-colors",
                                currentPath === item.href
                                    ? "bg-primary/10 text-primary font-semibold"
                                    : "hover:bg-slate-100 dark:hover:bg-surface-dark-lighter"
                            ]}
                            aria-current={currentPath === item.href ? "page" : undefined}
                        >
                            {item.label}
                        </a>
                    </li>
                ))}
            </ul>
        </div>
        <div class="p-4 border-t border-slate-200 dark:border-surface-dark-lighter">
            <a href="#" class="flex items-center justify-center w-full bg-primary hover:bg-primary-hover text-white px-4 py-3 rounded-lg text-sm font-bold transition-colors">
                Ota yhteyttä
            </a>
        </div>
    </div>
</nav>

<script>
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenuClose = document.getElementById('mobile-menu-close');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');

    let focusableElements: NodeListOf<HTMLElement>;
    let firstFocusable: HTMLElement | null = null;
    let lastFocusable: HTMLElement | null = null;

    function openMobileMenu() {
        if (!mobileMenu || !mobileMenuOverlay || !mobileMenuButton) return;

        mobileMenu.classList.add('active');
        mobileMenuOverlay.classList.add('active');
        mobileMenu.setAttribute('aria-hidden', 'false');
        mobileMenuOverlay.setAttribute('aria-hidden', 'false');
        mobileMenuButton.setAttribute('aria-expanded', 'true');
        document.body.style.overflow = 'hidden';

        // Set up focus trap
        focusableElements = mobileMenu.querySelectorAll(
            'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
        );
        firstFocusable = focusableElements[0];
        lastFocusable = focusableElements[focusableElements.length - 1];

        // Focus the close button
        if (mobileMenuClose) {
            mobileMenuClose.focus();
        }
    }

    function closeMobileMenu() {
        if (!mobileMenu || !mobileMenuOverlay || !mobileMenuButton) return;

        mobileMenu.classList.remove('active');
        mobileMenuOverlay.classList.remove('active');
        mobileMenu.setAttribute('aria-hidden', 'true');
        mobileMenuOverlay.setAttribute('aria-hidden', 'true');
        mobileMenuButton.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = '';

        // Return focus to the menu button
        mobileMenuButton.focus();
    }

    function handleMobileMenuKeydown(e: KeyboardEvent) {
        if (!mobileMenu?.classList.contains('active')) return;

        // Close on Escape
        if (e.key === 'Escape') {
            closeMobileMenu();
            return;
        }

        // Focus trap
        if (e.key === 'Tab') {
            if (e.shiftKey) {
                if (document.activeElement === firstFocusable) {
                    e.preventDefault();
                    lastFocusable?.focus();
                }
            } else {
                if (document.activeElement === lastFocusable) {
                    e.preventDefault();
                    firstFocusable?.focus();
                }
            }
        }
    }

    if (mobileMenuButton) {
        mobileMenuButton.addEventListener('click', openMobileMenu);
    }

    if (mobileMenuClose) {
        mobileMenuClose.addEventListener('click', closeMobileMenu);
    }

    if (mobileMenuOverlay) {
        mobileMenuOverlay.addEventListener('click', closeMobileMenu);
    }

    document.addEventListener('keydown', handleMobileMenuKeydown);

    // Close mobile menu on resize to desktop
    window.addEventListener('resize', () => {
        if (window.innerWidth >= 1024 && mobileMenu?.classList.contains('active')) {
            closeMobileMenu();
        }
    });
</script>
